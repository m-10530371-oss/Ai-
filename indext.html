<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Tarot Reader - å…¨é‚£ç½—å åœ</title>
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-main: #e0e0e0;
            --accent: #bb86fc;
            --secondary: #03dac6;
            --gold: #cfb53b;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        /* é¡¶éƒ¨å¯¼èˆª */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: rgba(30, 30, 30, 0.8);
            border-bottom: 1px solid #333;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        h1 { margin: 0; font-size: 1.5rem; color: var(--accent); }
        
        .lang-switch {
            cursor: pointer;
            padding: 5px 15px;
            border: 1px solid var(--accent);
            border-radius: 20px;
            transition: 0.3s;
        }
        .lang-switch:hover { background: var(--accent); color: #000; }

        /* ä¸»å®¹å™¨ */
        main {
            flex: 1;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
            width: 100%;
            box-sizing: border-box;
            text-align: center;
        }

        /* è¡¨å•æ ·å¼ */
        .form-group { margin-bottom: 20px; text-align: left; }
        label { display: block; margin-bottom: 8px; color: var(--secondary); font-weight: bold; }
        input, textarea, select {
            width: 100%;
            padding: 12px;
            background: #2c2c2c;
            border: 1px solid #444;
            color: white;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 1rem;
        }
        button {
            background: linear-gradient(45deg, var(--accent), #7c4dff);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1rem;
            border-radius: 30px;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 10px;
        }
        button:hover { transform: scale(1.05); }

        /* å¡ç‰ŒåŒºåŸŸ */
        .deck-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 5px;
            perspective: 1000px;
            margin-top: 20px;
        }

        .card-back {
            width: 50px;
            height: 85px;
            background: repeating-linear-gradient(45deg, #2b1d0e, #2b1d0e 5px, #46331a 5px, #46331a 10px);
            border: 1px solid #5a4626;
            border-radius: 4px;
            cursor: pointer;
            transition: transform 0.3s, opacity 0.3s;
        }
        .card-back:hover { transform: translateY(-10px); border-color: var(--gold); }
        .card-back.selected { opacity: 0; pointer-events: none; }

        /* ç»“æœå±•ç¤º */
        .result-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        .result-card {
            width: 150px;
            animation: fadeIn 1s ease;
        }
        .result-card img { width: 100%; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.6); }
        .position-title { color: var(--gold); margin-top: 10px; font-weight: bold; }

        /* AI æ–‡æœ¬åŒºåŸŸ */
        .ai-box {
            background: #1e1e1e;
            padding: 25px;
            border-radius: 10px;
            border-left: 4px solid var(--accent);
            text-align: left;
            line-height: 1.6;
            margin-top: 20px;
            white-space: pre-wrap;
        }
        .ai-loading { color: var(--secondary); font-style: italic; animation: pulse 1.5s infinite; }

        /* åº•éƒ¨ */
        footer {
            text-align: right;
            padding: 15px;
            font-size: 0.8rem;
            color: #666;
            position: fixed;
            bottom: 0;
            right: 0;
            width: 100%;
            pointer-events: none;
        }
        .author { pointer-events: auto; margin-right: 20px; }

        /* åŠ¨ç”»ä¸è¾…åŠ©ç±» */
        .hidden { display: none; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }
    </style>
</head>
<body>

<header>
    <h1>ğŸ”® Mystic AI Tarot</h1>
    <div class="lang-switch" onclick="toggleLanguage()">ä¸­æ–‡ / English</div>
</header>

<main>
    <!-- ç¬¬ä¸€é˜¶æ®µï¼šè¾“å…¥ä¸é€‰æ‹© -->
    <section id="phase-input">
        <h2 id="txt-welcome">æ¬¢è¿æ¥åˆ°å¡”ç½—åœ£æ®¿</h2>
        <div class="form-group">
            <label id="lbl-theme">ä¸»é¢˜ (Theme):</label>
            <input type="text" id="input-theme" placeholder="ä¾‹å¦‚ï¼šçˆ±æƒ…ã€äº‹ä¸šã€å­¦ä¸š...">
        </div>
        <div class="form-group">
            <label id="lbl-question">ä½ çš„é—®é¢˜ (Your Question):</label>
            <textarea id="input-question" rows="3" placeholder="è¯·åœ¨æ­¤è¾“å…¥ä½ æƒ³å åœçš„å…·ä½“é—®é¢˜..."></textarea>
        </div>
        <div class="form-group">
            <label id="lbl-spread">ç‰Œé˜µé€‰æ‹© (Spread Type):</label>
            <select id="select-spread">
                <option value="time">ä¸‰ç‰Œé˜µ - è¿‡å»ã€ç°åœ¨ã€æœªæ¥</option>
                <option value="triangle">åœ£ä¸‰è§’ç‰Œé˜µ - æ˜¾ç¤ºç›²ç‚¹</option>
                <option value="core">ç›´æŒ‡æ ¸å¿ƒç‰Œé˜µ - é‡æ¸…é—®é¢˜</option>
            </select>
        </div>
        <button onclick="processInput()" id="btn-start">æäº¤ç»™ AI åˆ†æ</button>
    </section>

    <!-- ä¸­é—´è¿‡æ¸¡ï¼šAIè®¡ç®— -->
    <section id="phase-calc" class="hidden">
        <h2 class="ai-loading" id="txt-calculating">AI æ­£åœ¨åˆ†ææ‚¨çš„é—®é¢˜...</h2>
        <p id="txt-calc-result"></p>
    </section>

    <!-- ç¬¬äºŒé˜¶æ®µï¼šæŠ½ç‰Œ -->
    <section id="phase-draw" class="hidden">
        <h2 id="txt-draw-instr">è¯·å‡­ç›´è§‰æŠ½å– 3 å¼ ç‰Œ</h2>
        <p id="draw-count">0 / 3</p>
        <div class="deck-container" id="deck-grid"></div>
    </section>

    <!-- ç¬¬ä¸‰é˜¶æ®µï¼šç»“æœä¸è§£è¯» -->
    <section id="phase-result" class="hidden">
        <h2 id="txt-revelation">ç‰Œé¢å¯ç¤º</h2>
        <div class="result-grid" id="cards-display"></div>
        
        <div class="ai-box">
            <h3 id="txt-ai-title">AI æ·±åº¦è§£è¯»æŠ¥å‘Š</h3>
            <div id="ai-content"></div>
        </div>
        <button onclick="location.reload()" style="margin-top:30px;" id="btn-restart">é‡æ–°å åœ</button>
    </section>
</main>

<footer>
    <div class="author">Author: Bryan Lye Wai Meng</div>
</footer>

<script>
    // --- æ ¸å¿ƒæ•°æ®ï¼š78å¼ å¡”ç½—ç‰Œ (å¼•ç”¨ç½‘ç»œå…¬å¼€å›¾æº) ---
    const CARD_BASE_URL = "https://sacred-texts.com/tarot/pkt/img/"; // éŸ¦ç‰¹å¡”ç½—ç‰Œå›¾æº
    const cardsData = [];
    
    // æ„å»ºæ•°æ®
    const suits = [
        {code:'sw', cn:'å®å‰‘', en:'Swords'}, 
        {code:'wa', cn:'æƒæ–', en:'Wands'}, 
        {code:'cu', cn:'åœ£æ¯', en:'Cups'}, 
        {code:'pe', cn:'æ˜Ÿå¸', en:'Pentacles'}
    ];
    const ranks = ['Ace','Two','Three','Four','Five','Six','Seven','Eight','Nine','Ten','Page','Knight','Queen','King'];
    const majorsEn = ["The Fool","The Magician","The High Priestess","The Empress","The Emperor","The Hierophant","The Lovers","The Chariot","Strength","The Hermit","Wheel of Fortune","Justice","The Hanged Man","Death","Temperance","The Devil","The Tower","The Star","The Moon","The Sun","Judgement","The World"];
    const majorsCn = ["æ„šäºº","é­”æœ¯å¸ˆ","å¥³ç¥­å¸","çš‡å","çš‡å¸","æ•™çš‡","æ‹äºº","æˆ˜è½¦","åŠ›é‡","éšå£«","å‘½è¿ä¹‹è½®","æ­£ä¹‰","å€’åŠäºº","æ­»ç¥","èŠ‚åˆ¶","æ¶é­”","é«˜å¡”","æ˜Ÿæ˜Ÿ","æœˆäº®","å¤ªé˜³","å®¡åˆ¤","ä¸–ç•Œ"];

    // ç”Ÿæˆ Major Arcana
    for(let i=0; i<22; i++) {
        let fileCode = (i < 10 ? 'ar0'+i : 'ar'+i); // sacred-texts format
        cardsData.push({
            id: `major_${i}`,
            nameCn: majorsCn[i],
            nameEn: majorsEn[i],
            img: `${CARD_BASE_URL}${fileCode}.jpg`,
            type: 'major',
            meaningCn: "ä»£è¡¨é‡å¤§çš„äººç”Ÿè¯¾é¢˜ã€ç²¾ç¥å±‚é¢çš„å½±å“æˆ–ä¸å¯æŠ—æ‹’çš„å‘½è¿åŠ›é‡ã€‚",
            meaningEn: "Represents significant life lessons, spiritual influences, or karmic forces."
        });
    }
    // ç”Ÿæˆ Minor Arcana
    suits.forEach(suit => {
        ranks.forEach((rank, idx) => {
            let num = idx + 1;
            let fileCode = (num < 10 ? suit.code+'0'+num : suit.code+num);
            // sacred-texts naming quirk: Page=11, Knight=12, Queen=13, King=14 in filenames usually but varies.
            // Adjusting for sacred-texts specific mapping: s, w, c, p + number. 
            // Checking sacred-texts: sw01...sw14 (King). 
            // So pure numeric append works.
            cardsData.push({
                id: `${suit.code}_${num}`,
                nameCn: `${suit.cn} ${rank}`, // ç®€å•å¤„ç† rank ç¿»è¯‘ï¼Œå®é™…åº”ç”¨å¯æ›´ç»†è‡´
                nameEn: `${rank} of ${suit.en}`,
                img: `${CARD_BASE_URL}${fileCode}.jpg`,
                type: 'minor',
                meaningCn: `æ¶‰åŠ${suit.cn}å±‚é¢çš„æ—¥å¸¸äº‹åŠ¡ã€æƒ…æ„Ÿã€è¡ŒåŠ¨æˆ–ç‰©è´¨çŠ¶å†µã€‚`,
                meaningEn: `Relates to daily affairs, emotions, actions, or material aspects of ${suit.en}.`
            });
        });
    });

    // --- è¯­è¨€åŒ… ---
    const i18n = {
        zh: {
            welcome: "æ¬¢è¿æ¥åˆ°å¡”ç½—åœ£æ®¿",
            theme: "ä¸»é¢˜ (Theme):",
            question: "ä½ çš„é—®é¢˜ (Your Question):",
            spread: "ç‰Œé˜µé€‰æ‹©:",
            start: "æäº¤ç»™ AI åˆ†æ",
            calculating: "AI æ­£åœ¨åˆ†ææ‚¨çš„é—®é¢˜å¹¶ç¡®å®šç‰Œé˜µç»“æ„...",
            calcResult: "AI å»ºè®®ï¼šæ ¹æ®æ‚¨çš„éœ€æ±‚ï¼Œéœ€è¦æŠ½å– 3 å¼ å¡ç‰Œã€‚",
            drawInstr: "è¯·å‡­ç›´è§‰æŠ½å– 3 å¼ ç‰Œ",
            revelation: "ç‰Œé¢å¯ç¤º",
            aiTitle: "AI æ·±åº¦è§£è¯»æŠ¥å‘Š",
            restart: "é‡æ–°å åœ",
            spreadOptions: {
                time: "ä¸‰ç‰Œé˜µ - è¿‡å»ã€ç°åœ¨ã€æœªæ¥",
                triangle: "åœ£ä¸‰è§’ç‰Œé˜µ - æ˜¾ç¤ºç›²ç‚¹",
                core: "ç›´æŒ‡æ ¸å¿ƒç‰Œé˜µ - é‡æ¸…é—®é¢˜"
            },
            positions: {
                time: ["è¿‡å» (èµ·å› )", "ç°åœ¨ (ç°çŠ¶)", "æœªæ¥ (è¶‹åŠ¿)"],
                triangle: ["æ˜¾ç¤ºç›²ç‚¹ (æ½œæ„è¯†)", "å½“å‰çŠ¶æ€ (æ˜¾æ„è¯†)", "ç»“æœé¢„æµ‹ (ç»¼åˆ)"],
                core: ["æ ¸å¿ƒé—®é¢˜ (ç—‡ç»“)", "é˜»ç¢/å¸®åŠ© (å½±å“)", "è§£å†³æ–¹æ¡ˆ (å»ºè®®)"]
            },
            aiText: {
                intro: "æ ¹æ®æ‚¨å…³äºã€Œ{theme}ã€çš„æé—®ï¼šã€Œ{question}ã€ï¼Œæˆ‘ä¸ºæ‚¨è§£è¯»å¦‚ä¸‹ï¼š",
                posPrefix: "ğŸ‘‰ **ä½ç½® {pos} ({posName})**ï¼šæŠ½åˆ°äº† **ã€{cardName}ã€‘**ã€‚",
                meaning: "ğŸ’¡ **å«ä¹‰**ï¼š{meaning}",
                advice: "âš ï¸ **æé†’/æ³¨æ„**ï¼šè¿™å¼ ç‰Œåœ¨è¿™é‡Œæç¤ºæ‚¨...",
                summary: "ğŸ”® **ç»¼åˆå»ºè®®**ï¼šçºµè§‚æ•´ä¸ªç‰Œé¢ï¼Œå»ºè®®æ‚¨ä¿æŒå†·é™ï¼Œè·Ÿéšç¬¬ä¸€å¼ ç‰Œçš„æŒ‡å¼•ï¼ŒåŒæ—¶æ³¨æ„è°ƒæ•´å¿ƒæ€ã€‚",
                author: "è§£è¯»ç”Ÿæˆï¼šMystic AI Engine"
            }
        },
        en: {
            welcome: "Welcome to the Tarot Sanctuary",
            theme: "Theme:",
            question: "Your Question:",
            spread: "Select Spread:",
            start: "Submit to AI",
            calculating: "AI is analyzing your question and determining structure...",
            calcResult: "AI Determination: You need to draw 3 cards.",
            drawInstr: "Trust your intuition and pick 3 cards",
            revelation: "The Revelation",
            aiTitle: "AI Interpretation Report",
            restart: "New Reading",
            spreadOptions: {
                time: "Three Card - Past, Present, Future",
                triangle: "Holy Triangle - Blind Spot",
                core: "Point to Core - Clarify Problem"
            },
            positions: {
                time: ["Past (Cause)", "Present (Current)", "Future (Trend)"],
                triangle: ["Blind Spot", "Current State", "Result"],
                core: ["Core Problem", "Obstacle/Help", "Solution"]
            },
            aiText: {
                intro: "Based on your theme '{theme}' and question '{question}', here is the reading:",
                posPrefix: "ğŸ‘‰ **Position {pos} ({posName})**: You drew **[{cardName}]**.",
                meaning: "ğŸ’¡ **Meaning**: {meaning}",
                advice: "âš ï¸ **Note/Warning**: This card suggests you should...",
                summary: "ğŸ”® **Overall Advice**: Looking at the spread, maintain balance and heed the guidance of the first card.",
                author: "Generated by: Mystic AI Engine"
            }
        }
    };

    // --- å…¨å±€çŠ¶æ€ ---
    let currentLang = 'zh';
    let userTheme = '';
    let userQuestion = '';
    let selectedSpread = 'time';
    let selectedCards = [];
    let deck = [];

    // --- é€»è¾‘æ§åˆ¶ ---

    function toggleLanguage() {
        currentLang = currentLang === 'zh' ? 'en' : 'zh';
        updateUI();
    }

    function updateUI() {
        const t = i18n[currentLang];
        document.getElementById('txt-welcome').innerText = t.welcome;
        document.getElementById('lbl-theme').innerText = t.theme;
        document.getElementById('lbl-question').innerText = t.question;
        document.getElementById('lbl-spread').innerText = t.spread;
        document.getElementById('btn-start').innerText = t.start;
        document.getElementById('txt-calculating').innerText = t.calculating;
        document.getElementById('txt-calc-result').innerText = t.calcResult;
        document.getElementById('txt-draw-instr').innerText = t.drawInstr;
        document.getElementById('txt-revelation').innerText = t.revelation;
        document.getElementById('txt-ai-title').innerText = t.aiTitle;
        document.getElementById('btn-restart').innerText = t.restart;

        // æ›´æ–°ä¸‹æ‹‰èœå•
        const sel = document.getElementById('select-spread');
        sel.options[0].text = t.spreadOptions.time;
        sel.options[1].text = t.spreadOptions.triangle;
        sel.options[2].text = t.spreadOptions.core;
    }

    function processInput() {
        userTheme = document.getElementById('input-theme').value;
        userQuestion = document.getElementById('input-question').value;
        selectedSpread = document.getElementById('select-spread').value;

        if(!userTheme || !userQuestion) {
            alert(currentLang==='zh' ? "è¯·è¾“å…¥å®Œæ•´çš„ä¸»é¢˜å’Œé—®é¢˜" : "Please enter both theme and question.");
            return;
        }

        // åˆ‡æ¢åˆ° AI è®¡ç®—ç•Œé¢
        document.getElementById('phase-input').classList.add('hidden');
        document.getElementById('phase-calc').classList.remove('hidden');

        // æ¨¡æ‹Ÿ AI è®¡ç®—å»¶è¿Ÿ
        setTimeout(() => {
            document.getElementById('txt-calculating').style.animation = 'none';
            document.getElementById('txt-calc-result').style.opacity = 1;
            
            setTimeout(() => {
                document.getElementById('phase-calc').classList.add('hidden');
                document.getElementById('phase-draw').classList.remove('hidden');
                initDeck();
            }, 1500);
        }, 1500);
    }

    function initDeck() {
        const grid = document.getElementById('deck-grid');
        grid.innerHTML = '';
        // æ´—ç‰Œ
        deck = [...cardsData].sort(() => Math.random() - 0.5);
        
        // æ¸²æŸ“78å¼ ç‰ŒèƒŒ
        deck.forEach((card, index) => {
            const div = document.createElement('div');
            div.className = 'card-back';
            div.onclick = () => selectCard(div, card);
            grid.appendChild(div);
        });
    }

    function selectCard(element, cardData) {
        if(selectedCards.length >= 3) return;
        
        element.classList.add('selected');
        selectedCards.push(cardData);
        
        document.getElementById('draw-count').innerText = `${selectedCards.length} / 3`;

        if(selectedCards.length === 3) {
            setTimeout(showResult, 800);
        }
    }

    function showResult() {
        document.getElementById('phase-draw').classList.add('hidden');
        document.getElementById('phase-result').classList.remove('hidden');

        const container = document.getElementById('cards-display');
        const t = i18n[currentLang];
        const posNames = t.positions[selectedSpread];

        // æ¸²æŸ“ç»“æœå¡ç‰Œ
        selectedCards.forEach((card, i) => {
            const wrap = document.createElement('div');
            wrap.className = 'result-card';
            wrap.innerHTML = `
                <img src="${card.img}" alt="${card.nameEn}">
                <div class="position-title">${posNames[i]}</div>
                <div>${currentLang==='zh'?card.nameCn:card.nameEn}</div>
            `;
            container.appendChild(wrap);
        });

        generateAIAnalysis(posNames);
    }

    function generateAIAnalysis(posNames) {
        const t = i18n[currentLang].aiText;
        let content = "";

        // 1. å¼€åœºç™½
        content += t.intro.replace('{theme}', userTheme).replace('{question}', userQuestion) + "\n\n";
        content += "----------------------------------------\n\n";

        // 2. é€å¼ è§£è¯»
        selectedCards.forEach((card, i) => {
            let cardName = currentLang==='zh' ? card.nameCn : card.nameEn;
            let meaning = currentLang==='zh' ? card.meaningCn : card.meaningEn;
            
            content += t.posPrefix.replace('{pos}', i+1).replace('{posName}', posNames[i]).replace('{cardName}', cardName) + "\n";
            content += t.meaning.replace('{meaning}', meaning) + "\n";
            
            // æ¨¡æ‹ŸåŠ¨æ€å»ºè®®
            let specificAdvice = "";
            if(card.type === 'major') {
                specificAdvice = currentLang==='zh' ? "è¿™æ˜¯ä¸€å¼ å¤§é˜¿å¡çº³ç‰Œï¼Œæ„å‘³ç€æ­¤å› ç´ å¯¹æ‚¨æœ‰æ·±è¿œçš„å½±å“ï¼Œä¸å¯å¿½è§†ã€‚" : "This is a Major Arcana card, indicating a profound influence.";
            } else {
                specificAdvice = currentLang==='zh' ? "è¯·å…³æ³¨ç”Ÿæ´»ä¸­å¾®å°çš„ç»†èŠ‚å˜åŒ–ã€‚" : "Pay attention to small details in daily life.";
            }
            content += t.advice + " " + specificAdvice + "\n\n";
        });

        // 3. æ€»ç»“
        content += "----------------------------------------\n";
        content += t.summary + "\n\n";
        content += `*${t.author}*`;

        // æ‰“å­—æœºæ•ˆæœ
        const aiBox = document.getElementById('ai-content');
        aiBox.innerHTML = '';
        let i = 0;
        const speed = 20; 
        
        function typeWriter() {
            if (i < content.length) {
                aiBox.innerHTML += content.charAt(i) === '\n' ? '<br>' : content.charAt(i);
                i++;
                setTimeout(typeWriter, speed);
            }
        }
        typeWriter();
    }

    // åˆå§‹åŒ–
    updateUI();
</script>

</body>
</html>